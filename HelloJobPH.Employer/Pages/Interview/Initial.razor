@page "/Interview/initial"
@using HelloJobPH.Employer.Services.ChatService
@using Microsoft.AspNetCore.SignalR.Client
@inject NavigationManager Navigation
@inject IClientInterviewService CandidateService
@inject IDialogService DialogService
@inject ISnackbar Snackbar
@inject IJSRuntime JS
@inject NavigationManager NavigationManager
@inject HttpClient Http
@using System.Net.Http.Json
@inject ChatService ChatService
@inject AuthenticationStateProvider AuthProvider



<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-4">
    <MudPaper Elevation="2" Class="pa-6">
        <MudStack Spacing="4">
            <!-- Header Section -->
            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                <MudStack Spacing="1">
                    <MudText Typo="Typo.h5" Color="Color.Primary">
                        <MudIcon Icon="@Icons.Material.Filled.CalendarMonth" Class="mr-2" />
                        Initial Interviews
                    </MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        Manage and review scheduled initial interview candidates
                    </MudText>
                </MudStack>

                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <!-- Search bar -->
                    <MudTextField @bind-Value="_searchString"
                                  Placeholder="Search candidate or position..."
                                  Adornment="Adornment.Start"
                                  AdornmentIcon="@Icons.Material.Filled.Search"
                                  Class="me-3"
                                  Immediate="true"
                                  Variant="Variant.Outlined"
                                  Size="Size.Small" />

                    <!-- Candidate count chip -->
                    <MudChip T="string" Icon="@Icons.Material.Filled.People" Color="Color.Info" Variant="Variant.Filled">
                        @filteredInitial.Count Candidate@(filteredInitial.Count != 1 ? "s" : "")
                    </MudChip>
                </MudStack>
            </MudStack>

            <MudDivider />

            <!-- Table Section -->
            <MudTable Dense="false"
                      Hover="true"
                      Bordered="false"
                      Striped="true"
                      Breakpoint="Breakpoint.Sm"
                      Items="@filteredInitial"
                      Elevation="0"
                      Class="rounded-lg">
                <HeaderContent>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Candidate</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Position</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Status</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Resume</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Interview Date</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Time</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Interview by</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Type</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Actions</strong></MudText></MudTh>
                </HeaderContent>

                <RowTemplate>
                    <MudTd DataLabel="Candidate">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                            <MudAvatar Color="Color.Primary" Size="Size.Small">
                                @context.Firstname?.Substring(0, 1)@context.Lastname?.Substring(0, 1)
                            </MudAvatar>
                            <MudText Typo="Typo.body2">
                                <strong>@context.Firstname @context.Lastname</strong>
                            </MudText>
                        </MudStack>
                    </MudTd>
                    <MudTd DataLabel="Position">
                        <MudText Typo="Typo.body2">@context.JobTitle</MudText>
                    </MudTd>
                    <MudTd DataLabel="Status">
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Filled" Color="Color.Info">
                            @context.Status
                        </MudChip>
                        @if (context.MarkAsCompleted == 1)
                        {
                            <span class="badge bg-success ms-2 px-2 py-1" style="font-size: 0.75rem; font-weight: 600;">
                                <i class="bi bi-check-circle-fill me-1"></i> Completed
                            </span>
                        }
                    </MudTd>
                    <MudTd DataLabel="Resume">
                        <MudButton StartIcon="@Icons.Material.Filled.Description"
                                   Size="Size.Small"
                                   Variant="Variant.Text"
                                   Color="Color.Primary"
                                   OnClick="@(() => ViewResume(context.ApplicationId))">
                            View Resume
                        </MudButton>
                    </MudTd>
                    <MudTd DataLabel="Interview Date">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.Event" Size="Size.Small" Color="Color.Secondary" />
                            <MudText Typo="Typo.body2">@context.DateInterview?.ToString("dd MMM yyyy")</MudText>
                        </MudStack>
                    </MudTd>
                    <MudTd DataLabel="Time">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.AccessTime" Size="Size.Small" Color="Color.Secondary" />
                            <MudText Typo="Typo.body2">@context.TimeInterview</MudText>
                        </MudStack>
                    </MudTd>
                    <MudTd DataLabel="Time">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.Person3" Size="Size.Small" Color="Color.Secondary" />
                            <MudText Typo="Typo.body2">@context.AssignTo</MudText>
                        </MudStack>
                    </MudTd>
                    <MudTd DataLabel="Type">
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined">@context.Type</MudChip>
                    </MudTd>
                    <MudTd DataLabel="Actions">
                        <MudMenu Icon="@Icons.Material.Filled.MoreVert"
                                 Size="Size.Small"
                                 Dense="true"
                                 AnchorOrigin="Origin.BottomLeft">
                            <MudMenuItem IconColor="Color.Info" Icon="@Icons.Material.Filled.Schedule" OnClick="@(() => Reschedule(context))">Reschedule</MudMenuItem>
                            <MudMenuItem IconColor="Color.Error" Icon="@Icons.Material.Filled.PersonOff" OnClick="@(() => NoAppearance(context.ApplicationId))">No Appearance</MudMenuItem>
                            <MudDivider />
                            @* <MudMenuItem OnClick="@(() => OpenSendEmailDialog(context))">Send Email</MudMenuItem> *@
                            <MudMenuItem IconColor="Color.Secondary" Icon="@Icons.Material.Filled.Build" OnClick="@(() => ForTechnical(context))">Technical</MudMenuItem>
                            <MudMenuItem IconColor="Color.Warning" Icon="@Icons.Material.Filled.EmojiEvents" OnClick="@(() => ForFinal(context))">Final</MudMenuItem>
                            <MudMenuItem IconColor="Color.Error" Icon="@Icons.Material.Filled.Cancel" OnClick="@(() => Failed(context.ApplicationId))" >Failed</MudMenuItem>
                            <MudDivider />
                            <MudMenuItem IconColor="Color.Error"  OnClick="@(() => Delete(context.ApplicationId))" Icon="@Icons.Material.Filled.Delete">Delete</MudMenuItem>
                            <MudMenuItem IconColor="Color.Tertiary"Icon="@Icons.Material.Filled.Visibility" OnClick="@(() => NavigateToOverview(context.ApplicationId))">Overview</MudMenuItem>
                            <MudMenuItem Variant="Variant.Text" Icon="@Icons.Material.Filled.Chat" OnClick="() => OpenChat(context.UserAccountId, context.Firstname)">Chat</MudMenuItem>
                            <MudMenuItem IconColor="Color.Success" Icon="@Icons.Material.Filled.MarkChatRead" OnClick="@(() => MarkAsCompleted(context.ApplicationId))">Mark As Completed</MudMenuItem>
                            <MudMenuItem IconColor="Color.Success" Icon="@Icons.Material.Filled.MarkChatRead" OnClick="@(() => Hired(context.ApplicationId))">Hired</MudMenuItem>
                        </MudMenu>
                    </MudTd>
                </RowTemplate>

                <NoRecordsContent>
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-8">
                        <MudIcon Icon="@Icons.Material.Filled.EventBusy" Size="Size.Large" Color="Color.Secondary" />
                        <MudText Typo="Typo.h6" Color="Color.Secondary">No Scheduled Interviews</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">
                            There are no candidates scheduled for initial interviews at this time.
                        </MudText>
                    </MudStack>
                </NoRecordsContent>
            </MudTable>
        </MudStack>
    </MudPaper>
</MudContainer>

@code {
    private string _searchString = string.Empty;

    private List<InterviewListDtos> filteredInitial =>
        string.IsNullOrWhiteSpace(_searchString)
            ? initial
            : initial.Where(x =>
                (x.Firstname + " " + x.Lastname).Contains(_searchString, StringComparison.OrdinalIgnoreCase) ||
                (x.JobTitle ?? string.Empty).Contains(_searchString, StringComparison.OrdinalIgnoreCase) ||
                (x.Status?.ToString() ?? string.Empty).Contains(_searchString, StringComparison.OrdinalIgnoreCase)
            ).ToList();
}







<!-- Floating Chat Boxes -->
<MudContainer>
    @foreach (var chat in openChats)
    {
        <MudPaper Elevation="10" Class="chat-container animate-fade-in" style="@($"right:{chat.OffsetRight}px")">

            <!-- Header -->
            <MudStack Row AlignItems="AlignItems.Center" JustifyContent="SpaceBetween" Class="chat-header">
                <MudText Typo="Typo.subtitle2">@chat.ApplicantName</MudText>
                <MudIconButton Icon="@Icons.Material.Filled.Close" Size="Size.Small" OnClick="@(() => CloseChat(chat))" />
            </MudStack>

            <!-- Messages -->
            <MudContainer Class="chat-body">
                @foreach (var msg in chat.Messages)
                {
                    <div class="message-row @(msg.User == senderId ? "sent" : "received")">
                        <div class="message-bubble @(msg.User == senderId ? "bubble-sent" : "bubble-received")">
                            @msg.Text
                        </div>
                    </div>
                }
            </MudContainer>

            <MudDivider />

            <!-- Input -->
            <MudStack Row AlignItems="AlignItems.Center" Spacing="1" Class="p-2 bg-white">
                <MudTextField @bind-Value="chat.NewMessage"
                              Placeholder="Type a message..."
                              Variant="Variant.Outlined"
                              Class="flex-grow rounded-full"
                              OnKeyDown="@(e => HandleKeyPress(e, chat))" />
                <MudIconButton Icon="@Icons.Material.Filled.Send"
                               Color="Color.Primary"
                               Size="Size.Medium"
                               OnClick="@(() => SendMessage(chat))" />
            </MudStack>

        </MudPaper>
    }
</MudContainer>

<style>
    /* Chat container */
    .chat-container {
        position: fixed;
        bottom: 10px;
        width: 320px;
        border-radius: 16px;
        margin: 10px;
        background-color: white;
        display: flex;
        flex-direction: column;
        box-shadow: 0px 4px 12px rgba(0,0,0,0.15);
        animation: fadeIn 0.3s ease-in-out;
    }

    /* Header */
    .chat-header {
        background-color: #1976d2;
        color: white;
        padding: 10px;
        font-weight: 600;
        border-radius: 16px 16px 0 0;
    }

    /* Body */
    .chat-body {
        padding: 10px;
        max-height: 350px;
        overflow-y: auto;
        background-color: #f5f5f5;
        display: flex;
        flex-direction: column;
        height: 400px;
    }

    /* Message rows */
    .message-row {
        display: flex;
        margin-bottom: 8px;
    }

        /* Sent (right side) */
        .message-row.sent {
            justify-content: flex-end;
        }

        /* Received (left side) */
        .message-row.received {
            justify-content: flex-start;
        }

    /* Message bubble */
    .message-bubble {
        max-width: 70%;
        padding: 10px 14px;
        border-radius: 18px;
        font-size: 0.9rem;
        line-height: 1.3;
        word-wrap: break-word;
    }

    /* Sender bubble */
    .bubble-sent {
        background-color: #1976d2;
        color: white;
        border-bottom-right-radius: 4px;
    }

    /* Receiver bubble */
    .bubble-received {
        background-color: #e0e0e0;
        color: #000;
        border-bottom-left-radius: 4px;
    }

    /* Input field */
    .mud-text-field {
        border-radius: 20px;
    }

    /* Fade animation */
    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .mud-badge.mud-badge-top.right {
        FONT-WEIGHT: 500;
        FONT-WEIGHT: 500;
        inset: auto auto calc(50% - 4px) calc(60% - 4px) !important
    }
</style>

@code {


    private HubConnection? hubConnection;
    private List<ChatSession> openChats = new();
    private List<InterviewListDtos> initial = new();
    private string senderId;
    private string receiverId;
    private string message = "";
    private List<(string User, string Text)> messages = new();



    public class ChatSession
    {
        public int ApplicantId { get; set; }
        public string ApplicantName { get; set; } = string.Empty;
        // store senderId + text; keep types explicit for readability
        public List<(string User, string Text)> Messages { get; set; } = new();
        public string NewMessage { get; set; } = string.Empty;
        public int OffsetRight { get; set; }
    }

    protected override async Task OnInitializedAsync()
    {
        var response = await CandidateService.InitialList();
        initial = response.Data; // assign the actual list

        if (!response.Success)
        {
            Snackbar.Add(response.Message ?? "Failed to load initial interviews.", Severity.Error);
        }


        // Optional: check success
        if (!response.Success)
        {
            Snackbar.Add(response.Message ?? "Failed to fetch initial list.", Severity.Error);
        }

        var authState = await AuthProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity?.IsAuthenticated == true)
        {
            senderId = user.FindFirst(ClaimTypes.NameIdentifier)?.Value;
        }

        // Initialize SignalR
        await ChatService.InitializeAsync();

        // Subscribe to incoming messages
        ChatService.OnMessageReceived += (user, msg) =>
        {
            messages.Add((user, msg));
            InvokeAsync(StateHasChanged);
        };


 
    }
    private async Task LoadChatHistory(string senderId, string receiverId)
    {
        try
        {
            var history = await ChatService.ChatHistory(receiverId, senderId);

            if (history != null)
            {
                // Map ChatMessageDtos to your messages list
                messages = history.Select(m => (m.SenderId, m.Message)).ToList();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading chat history: {ex.Message}");
        }
    }

    private void HandleKeyPress(KeyboardEventArgs e, ChatSession chat)
    {
        if (e.Key == "Enter" && !string.IsNullOrWhiteSpace(chat.NewMessage))
        {
            // fire and forget; method handles clearing
            _ = SendMessage(chat);
        }
    }

    private void CloseChat(ChatSession chat)
    {
        openChats.Remove(chat);
    }


    private async Task OpenChat(int ApplicantId, string Firstname)
    {
        receiverId = ApplicantId.ToString();
        if (string.IsNullOrEmpty(receiverId))
            return;

        // check if already open
        var existing = openChats.FirstOrDefault(c => c.ApplicantId == ApplicantId);
        if (existing == null)
        {
            int offset = 20 + (openChats.Count * 340);

            var newChat = new ChatSession
            {
                ApplicantId = ApplicantId,      
                ApplicantName = Firstname,
                OffsetRight = offset
            };

            openChats.Add(newChat);

            // load history (sender = you, receiver = applicant)
            await LoadChatHistory(senderId, receiverId, newChat);
        }

        StateHasChanged();
    }

    private async Task LoadChatHistory(string senderId, string receiverId, ChatSession chat)
    {
        try
        {
            var history = await ChatService.ChatHistory(receiverId, senderId);
            chat.Messages = history?.Select(m => (m.SenderId, m.Message)).ToList() ?? new();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading chat history: {ex.Message}");
        }
    }
    private async Task SendMessage(ChatSession chat)
    {
        if (chat == null || string.IsNullOrWhiteSpace(chat.NewMessage))
            return;
            
        var targetId = chat.ApplicantId.ToString();
        try
        {
            // Ensure ChatService.SendMessage has this signature (remoteId, message, senderId)
            await ChatService.SendMessage(targetId, chat.NewMessage, senderId);

            // append locally and clear input
            chat.Messages.Add((senderId, chat.NewMessage));
            chat.NewMessage = string.Empty;

            StateHasChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"SendMessage error: {ex.Message}");
        }
    }

    public async ValueTask DisposeAsync()
    {
        if (hubConnection is not null)
        {
            await hubConnection.DisposeAsync();
        }
    }
























    private void NavigateToOverview(int applicationId)
    {
        Navigation.NavigateTo($"/reviewapplicant/reviewapplicant/{applicationId}");
    }

    private async Task Reschedule(InterviewListDtos candidate)
    {
        var parameters = new DialogParameters
        {
            { "Candidate", candidate }
        };

        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Medium, FullWidth = true };

        await DialogService.ShowAsync<RescheduleDialog>("Send Interview Invitation", parameters, options);


    }

    private async Task ForTechnical(InterviewListDtos candidate)
    {
        var parameters = new DialogParameters
        {
            { "Candidate", candidate }
        };

        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Medium, FullWidth = true };

        await DialogService.ShowAsync<ForTechnicalDialog>("Send Interview Invitation", parameters, options);


    }
    private async Task ForFinal(InterviewListDtos candidate)
    {
        var parameters = new DialogParameters
        {
            { "Candidate", candidate }
        };

        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Medium, FullWidth = true };

        await DialogService.ShowAsync<ForFinalDialog>("Send Interview Invitation", parameters, options);


    }
    private async Task NoAppearance(int id)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Confirm Action",
            "Are you sure you want to mark this candidate as 'No Appearance'?",
            cancelText: "Cancel",
            yesText: "Yes"
        );

        if (result == true)
        {
            var response = await CandidateService.NoAppearance(id);

            if (response.Success && response.Data)
            {
                Snackbar.Add("Candidate marked as 'No Appearance'.", Severity.Success);
                NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true);
            }
            else
            {
                Snackbar.Add("Failed to update candidate status.", Severity.Error);
            }
        }
    }
    private async Task Failed(int id)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Confirm Action",
            "Are you sure you want to mark this candidate as 'Failed'?",
            cancelText: "Cancel",
            yesText: "Yes"
        );

        if (result == true)
        {
            var response = await CandidateService.Failed(id);

            if (response.Success && response.Data)
            {
                Snackbar.Add("Candidate marked as 'Failed'.", Severity.Success);
                NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true);
            }
            else
            {
                Snackbar.Add("Failed to update candidate status.", Severity.Error);
            }
        }
    }
    private async Task Delete(int id)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Confirm Action",
            "Are you sure you want to delete?",
            cancelText: "Cancel",
            yesText: "Yes"
        );

        if (result == true)
        {
            var response = await CandidateService.Delete(id);

            if (response.Success && response.Data)
            {
                Snackbar.Add($"{response.Message}", Severity.Success);
                NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true);
            }
            else
            {
                Snackbar.Add("Failed to update candidate status.", Severity.Error);
            }
        }
    }

    private async Task MarkAsCompleted(int id)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Confirm",
            "Are you sure you want to mark this candidate as 'Complete?'?",
            cancelText: "Cancel",
            yesText: "Yes"

        );

        if (result == true)
        {
            await CandidateService.MarkAsCompleted(id);
            NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true);
        }
    }
    private async Task Hired(int id)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Confirm",
            "Are you sure you want to mark this candidate as 'Hired?'?",
            cancelText: "Cancel",
            yesText: "Yes"

        );

        if (result == true)
        {
            await CandidateService.Hired(id);
            NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true);
        }
    }

    private async Task OpenSendEmailDialog(ApplicationListDtos candidate)
    {
        var parameters = new DialogParameters
        {
            { "Candidate", candidate }
        };

        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Medium, FullWidth = true };

        await DialogService.ShowAsync<SendEmailDialog>("Send Interview Invitation", parameters, options);
    }
     private async Task ViewResume(int applicationId)
    {

        var parameters = new DialogParameters
        {
            ["ApplicationId"] = applicationId
        };

        var options = new DialogOptions
        {
            MaxWidth = MaxWidth.Large,
            FullWidth = true,
            FullScreen = true,
            CloseButton = true,
            CloseOnEscapeKey = true
        };

        var dialog = DialogService.Show<ResumeDialog>("Resume Viewer", parameters, options);
        var result = await dialog.Result;
    }

}



@* <MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-4">
    <MudPaper Elevation="2" Class="pa-6">
        <MudStack Spacing="4">
            <!-- Header Section -->
            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                <MudStack Spacing="1">
                    <MudText Typo="Typo.h5" Color="Color.Primary">
                        <MudIcon Icon="@Icons.Material.Filled.CalendarMonth" Class="mr-2" />
                        Initial Interviews
                    </MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        Manage and review scheduled initial interview candidates
                    </MudText>
                </MudStack>

                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">

                    <!-- Candidate count chip -->
                    <MudChip T="string" Icon="@Icons.Material.Filled.People" Color="Color.Info" Variant="Variant.Filled">
                        @initial.Count Candidate@(initial.Count != 1 ? "s" : "")
                    </MudChip>
                </MudStack>
            </MudStack>

            <MudDivider />

            <!-- Table Section -->
            <MudTable Dense="false"
                      Hover="true"
                      Bordered="false"
                      Striped="true"
                      Breakpoint="Breakpoint.Sm"
                      Items="@initial"
                      Elevation="0"
                      Class="rounded-lg">
                <HeaderContent>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Candidate</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Position</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Status</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Resume</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Interview Date</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Time</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Type</strong></MudText></MudTh>
                    <MudTh><MudText Typo="Typo.subtitle2" Color="Color.Primary"><strong>Actions</strong></MudText></MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Candidate">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                            <MudAvatar Color="Color.Primary" Size="Size.Small">
                                @context.Firstname?.Substring(0, 1)@context.Lastname?.Substring(0, 1)
                            </MudAvatar>
                            <MudText Typo="Typo.body2">
                                <strong>@context.Firstname @context.Lastname</strong>
                            </MudText>
                        </MudStack>
                    </MudTd>
                    <MudTd DataLabel="Position">
                        <MudText Typo="Typo.body2">@context.JobTitle</MudText>
                    </MudTd>
                    <MudTd DataLabel="Status">
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Filled" Color="Color.Info">
                            @context.Status
                        </MudChip>
                        <span>@(context.MarkAsCompleted == 1 ? "Completed" : " ")</span>
                    </MudTd>
                    <MudTd DataLabel="Resume">
                        <MudButton StartIcon="@Icons.Material.Filled.Description"
                                   Size="Size.Small"
                                   Variant="Variant.Text"
                                   Color="Color.Primary"
                                   OnClick="@(() => ViewResume(context.ApplicationId))">
                            View Resume
                        </MudButton>
                    </MudTd>
                    <MudTd DataLabel="Interview Date">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.Event" Size="Size.Small" Color="Color.Secondary" />
                            <MudText Typo="Typo.body2">@context.DateInterview?.ToString("dd MMM yyyy")</MudText>
                        </MudStack>
                    </MudTd>
                    <MudTd DataLabel="Time">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.AccessTime" Size="Size.Small" Color="Color.Secondary" />
                            <MudText Typo="Typo.body2">@context.TimeInterview</MudText>
                        </MudStack>
                    </MudTd>
                    <MudTd DataLabel="Type">
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined">@context.Type</MudChip>
                    </MudTd>
                    <MudTd DataLabel="Actions">
                        <MudMenu Icon="@Icons.Material.Filled.MoreVert"
                                 Size="Size.Small"
                                 Dense="true"
                                 AnchorOrigin="Origin.BottomLeft">
                            <MudMenuItem Icon="@Icons.Material.Filled.Schedule" OnClick="@(() => Reschedule(context))">Reschedule</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.PersonOff" OnClick="@(() => NoAppearance(context.ApplicationId))">No Appearance</MudMenuItem>
                            <MudDivider />
                            <MudMenuItem Icon="@Icons.Material.Filled.Build" OnClick="@(() => ForTechnical(context))">Technical</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.EmojiEvents" OnClick="@(() => ForFinal(context))">Final</MudMenuItem>

                            <MudMenuItem Icon="@Icons.Material.Filled.Cancel" OnClick="@(() => Failed(context.ApplicationId))" Class="mud-error-text">Failed</MudMenuItem>
                            <MudDivider />
                            <MudMenuItem OnClick="@(() => Delete(context.ApplicationId))" Icon="@Icons.Material.Filled.Delete" Class="mud-error-text">Delete</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.Visibility"
                                         OnClick="@(()=> NavigateToOverview(context.ApplicationId))">
                                Overview
                            </MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.ChatBubble"
                                         OnClick="@(() => OpenChat(context))">
                                Chat
                            </MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.MarkChatRead"
                                         OnClick="@(() => MarkAsCompleted(context.ApplicationId))">
                                Mark As Completed
                            </MudMenuItem>
                        </MudMenu>
                    </MudTd>
                </RowTemplate>
                <NoRecordsContent>
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-8">
                        <MudIcon Icon="@Icons.Material.Filled.EventBusy" Size="Size.Large" Color="Color.Secondary" />
                        <MudText Typo="Typo.h6" Color="Color.Secondary">No Scheduled Interviews</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">
                            There are no candidates scheduled for initial interviews at this time.
                        </MudText>
                    </MudStack>
                </NoRecordsContent>
            </MudTable>
        </MudStack>
    </MudPaper>
</MudContainer> *@