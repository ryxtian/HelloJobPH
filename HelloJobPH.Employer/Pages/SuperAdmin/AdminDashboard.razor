@page "/superadmin/dashboard"
@using HelloJobPH.Employer.Services.SuperAdmin
@inject NavigationManager NavigationManager
@layout SuperAdminLayout
@inject IClientSuperAdminService DashboardService

<style>
    .stat-card {
        transition: all 0.3s ease;
        border-radius: 16px;
        overflow: hidden;
        position: relative;
    }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15) !important;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            opacity: 0.1;
        }

        .stat-card.primary::before {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card.success::before {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .stat-card.warning::before {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }

        .stat-card.info::before {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }

    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 16px;
        position: relative;
        overflow: hidden;
    }

        .page-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

    .chart-card {
        border-radius: 16px;
        transition: box-shadow 0.3s ease;
    }

        .chart-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.1) !important;
        }

    .trend-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .trend-up {
        background: rgba(72, 187, 120, 0.15);
        color: #48bb78;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }

    .status-active {
        background: #48bb78;
    }

    .status-pending {
        background: #ed8936;
    }

    .status-inactive {
        background: #cbd5e0;
    }
</style>


<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="pa-0">
    <MudGrid Spacing="4">
        <!-- Stats Cards -->
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Elevation="3" Class="pa-4">
                <MudStack Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.Work" Size="Size.Large" Style="font-size:48px;" />
                    <MudText Typo="Typo.h3" Style="font-weight:700;">@totalJobs</MudText>
                    <MudText Typo="Typo.body2">Total Job Posts</MudText>
                </MudStack>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6" md="3">
            <MudPaper Elevation="3" Class="pa-4">
                <MudStack Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.People" Size="Size.Large" Style="font-size:48px;" />
                    <MudText Typo="Typo.h3" Style="font-weight:700;">@totalApplicants</MudText>
                    <MudText Typo="Typo.body2">Total Members</MudText>
                </MudStack>
            </MudPaper>
        </MudItem>


        <MudItem xs="12" sm="6" md="3">
            <MudPaper Elevation="3" Class="pa-4">
                <MudStack Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.CalendarMonth" Size="Size.Large" Style="font-size:48px;" />
                    <MudText Typo="Typo.h3" Style="font-weight:700;">@totalInterviews</MudText>
                    <MudText Typo="Typo.body2">Scheduled Interviews</MudText>
                </MudStack>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6" md="3">
            <MudPaper Elevation="3" Class="pa-4">
                <MudStack Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Large" Style="font-size:48px;" />
                    <MudText Typo="Typo.h3" Style="font-weight:700;">@totalHired</MudText>
                    <MudText Typo="Typo.body2">Successful Hires</MudText>
                </MudStack>
            </MudPaper>
        </MudItem>


        <!-- Top Jobs Chart -->
        <MudItem xs="12" md="8">
            <MudPaper Elevation="3" Class="pa-4 chart-card">
                <MudStack Spacing="3">
                    <MudText Typo="Typo.h6" Style="font-weight:600;">Top Applied Jobs</MudText>
                    <MudChart ChartType="ChartType.Bar"
                              ChartSeries="@topJobsSeries"
                              XAxisLabels="@topJobsLabels"
                              Width="100%"
                              Height="350px"
                              ChartOptions="@chartOptions" />
                </MudStack>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="4">
            <MudPaper Elevation="3" Class="pa-4 chart-card">
                <MudText Typo="Typo.h6" Style="font-weight:600;">Application Status</MudText>
                <MudChart ChartType="ChartType.Donut"
                          InputData="@applicationStatusData"
                          InputLabels="@applicationStatusLabels"
                          Width="100%"
                          Height="300px" />
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    // Stats
    private int totalJobs;
    private int activeJobs;
    private int totalApplicants;
    private int newApplicants;
    private int totalInterviews;
    private int upcomingInterviews;
    private int totalHired;
    private int hiredThisMonth;

    // Chart Data
    private List<ChartSeries> applicationTrendSeries = new();
    private string[] chartLabels = Array.Empty<string>();
    private ChartOptions chartOptions = new();
    private double[] applicationStatusData = Array.Empty<double>();
    private string[] applicationStatusLabels = Array.Empty<string>();

    // Top Job Applications Data
    private List<ChartSeries> topJobsSeries = new();
    private string[] topJobsLabels = Array.Empty<string>();

    protected override async Task OnInitializedAsync()
    {
        await LoadStats();
        await LoadTopJobs();
        await LoadApplicationStatusChart();
        totalJobs = await DashboardService.TotalJobCounts();
        topJobsSeries = new List<ChartSeries>
{
    new ChartSeries { Name = "Applicants", Data = (await DashboardService.GetTopAppliedJobs()).Select(j => (double)j.ApplicantCount).ToArray() }
};
    }

    private async Task LoadStats()
    {
        totalJobs = await DashboardService.TotalJobCounts();
        totalApplicants = await DashboardService.TotalApplicants();
        totalInterviews = await DashboardService.ScheduledInterviews();
        totalHired = await DashboardService.SuccessfulHires();
    }

    private async Task LoadTopJobs()
    {
         //Assuming your service has a method like GetTopAppliedJobs()
        var topJobs = await DashboardService.GetTopAppliedJobs();

        topJobsLabels = topJobs.Select(j => j.JobTitle).ToArray();
        var applicantsData = topJobs.Select(j => (double)j.ApplicantCount).ToArray();

        topJobsSeries = new List<ChartSeries>
         {
             new ChartSeries { Name = "Applicants", Data = applicantsData }
         };
    }

    private async Task LoadApplicationStatusChart()
    {
        var statusCounts = await DashboardService.GetApplicationStatusCounts();

        applicationStatusLabels = statusCounts.Select(s => s.Status).ToArray();
        applicationStatusData = statusCounts.Select(s => (double)s.Count).ToArray();
    }

    // DTO for Top Jobs
    public class TopJobDto
    {
        public string JobTitle { get; set; } = string.Empty;
        public int ApplicantCount { get; set; }
    }
    public class ApplicationStatusDto
    {
        public string Status { get; set; } = string.Empty;
        public int Count { get; set; }
    }
}

