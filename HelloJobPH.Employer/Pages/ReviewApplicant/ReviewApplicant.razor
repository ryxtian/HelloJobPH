@page "/reviewapplicant/reviewapplicant/{id:int}"
@using HelloJobPH.Employer.Services.Overview
@using MudBlazor
@inject IClientOverview _service

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-6">
    @if (overview == null)
    {
        <MudPaper Class="pa-8 text-center" Elevation="0">
            <MudProgressCircular Indeterminate="true" Color="Color.Primary" Size="Size.Large" />
            <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mt-3">Loading applicant details...</MudText>
        </MudPaper>
    }
    else
    {
        <!-- Page Header -->
        <div class="d-flex align-center mb-4">
            <MudIcon Icon="@Icons.Material.Filled.PersonSearch" Size="Size.Large" Color="Color.Primary" Class="mr-3" />
            <div>
                <MudText Typo="Typo.h4">Application Review</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Review applicant profile and job application details</MudText>
            </div>
        </div>

        <MudGrid Spacing="4">
            <!-- Left Column: Applicant Info -->
            <MudItem xs="12" lg="4">
                <!-- Applicant Profile -->
                <MudCard Elevation="2" Class="mb-4">
                    <MudCardContent Class="text-center pa-6">
                        <MudAvatar Size="Size.Large" Class="mx-auto mb-3" Style="width: 120px; height: 120px;">
                            <MudImage Src="images/avatar/avatar-13.png" Alt="Applicant" />
                        </MudAvatar>
                        <MudText Typo="Typo.h5" Class="fw-bold">@overview.Firstname @overview.Lastname</MudText>
                        <MudChip T="string" Size="Size.Small" Color="Color.Primary" Class="mt-2">Applicant</MudChip>
                    </MudCardContent>
                    
                    <MudDivider />
                    
                    <MudCardContent Class="pa-4">
                        <MudList T="string"Dense="true">
                            <MudListItem>
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Small" Color="Color.Primary" Class="mr-3" />
                                    <div>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">Full Name</MudText>
                                        <MudText Typo="Typo.body2" Class="fw-medium">@overview.Firstname @overview.Lastname</MudText>
                                    </div>
                                </div>
                            </MudListItem>
                            <MudListItem>
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Phone" Size="Size.Small" Color="Color.Primary" Class="mr-3" />
                                    <div>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">Mobile</MudText>
                                        <MudText Typo="Typo.body2" Class="fw-medium">@overview.Phone</MudText>
                                    </div>
                                </div>
                            </MudListItem>
                            <MudListItem>
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Email" Size="Size.Small" Color="Color.Primary" Class="mr-3" />
                                    <div>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">Email</MudText>
                                        <MudText Typo="Typo.body2" Class="fw-medium">@overview.Email</MudText>
                                    </div>
                                </div>
                            </MudListItem>
                            <MudListItem>
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.LocationOn" Size="Size.Small" Color="Color.Primary" Class="mr-3" />
                                    <div>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">Location</MudText>
                                        <MudText Typo="Typo.body2" Class="fw-medium">@overview.Location</MudText>
                                    </div>
                                </div>
                            </MudListItem>
                        </MudList>
                    </MudCardContent>
                </MudCard>

                <!-- Work Experience -->
                <MudCard Elevation="2" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <div class="d-flex align-center">
                                <MudIcon Icon="@Icons.Material.Filled.Work" Class="mr-2" Color="Color.Info" />
                                <MudText Typo="Typo.h6">Work Experience</MudText>
                            </div>
                        </CardHeaderContent>
                    </MudCardHeader>
                <MudCardContent>
        @if (overview.WorkExperiences != null && overview.WorkExperiences.Any())
        {
            @foreach (var work in overview.WorkExperiences)
            {
               
                    <MudText Typo="Typo.subtitle1" Color="Color.Primary">@work.CompanyName</MudText>
                    <MudText Typo="Typo.body2">@work.PositionTitle (@work.Department)</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">
                        @work.StartDate
                        -
                        @(work.IsPresent ? "Present" : work.EndDate?.ToString("MMM yyyy"))
                    </MudText>
                    <MudText Typo="Typo.body2" Class="mt-1">@work.Responsibilities</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">@work.CompanyAddress</MudText>
            
            }
        }
        else
        {
            <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center" Class="py-4">
                <MudIcon Icon="@Icons.Material.Filled.WorkOff" Size="Size.Large" Color="Color.Secondary" Class="mb-2" />
                <br />No work experience data available
            </MudText>
        }
    </MudCardContent>
                </MudCard>

                <!-- Educational Background -->
                <MudCard Elevation="2">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <div class="d-flex align-center">
                                <MudIcon Icon="@Icons.Material.Filled.School" Class="mr-2" Color="Color.Info" />
                                <MudText Typo="Typo.h6">Educational Background</MudText>
                            </div>
                        </CardHeaderContent>
                    </MudCardHeader>

            <MudCardContent>
    @if (overview?.EducationalAttainment != null && overview.EducationalAttainment.Any())
    {
        @foreach (var school in overview.EducationalAttainment)
        {
            <MudPaper Elevation="0" Class="pa-3 mb-3" Style="background: var(--mud-palette-surface); border-left: 4px solid var(--mud-palette-primary);">
                <MudText Typo="Typo.subtitle1" Class="fw-bold">@school.SchoolName - @school.Degree ?? "NA"</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">@school.Degree</MudText>
                <MudText Typo="Typo.caption" Color="Color.Secondary">
                       @school.YearStarted?.ToString("yyyy") - @(school.YearEnded?.ToString("yyyy"))
                </MudText>
            </MudPaper>
        }
    }
    else
    {
        <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center" Class="py-4">
          <MudIcon Icon="@Icons.Material.Outlined.School" Size="Size.Large" Color="Color.Secondary" Class="mb-2" />
            <br />No educational attainment data available
        </MudText>
    }
</MudCardContent>

                </MudCard>
            </MudItem>

            <!-- Right Column: Job Details -->
            <MudItem xs="12" lg="8">
                <MudCard Elevation="2">
                    <MudCardHeader Class="pa-4" Style="background: linear-gradient(135deg, var(--mud-palette-primary) 0%, var(--mud-palette-primary-darken) 100%);">
                        <CardHeaderContent>
                            <div class="d-flex align-center justify-space-between">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Work" Size="Size.Medium" Class="mr-2" Style="color: white;" />
                                    <MudText Typo="Typo.h5" Style="color: white; font-weight: 600;">Job Application Details</MudText>
                                </div>
                                <MudChip T="string"Size="Size.Small" Style="background: rgba(255,255,255,0.2); color: white;">
                                    <MudIcon Icon="@Icons.Material.Filled.CalendarToday" Size="Size.Small" Class="mr-1" />
                                    @overview.JobPostedDate
                                </MudChip>
                            </div>
                        </CardHeaderContent>
                    </MudCardHeader>
                    
                    <MudCardContent Class="pa-6">
                        <!-- Job Title Highlight -->
                        <MudPaper Elevation="0" Class="pa-4 mb-4" Style="background: var(--mud-palette-primary-lighten); border-left: 4px solid var(--mud-palette-primary);">
                            <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="mb-1">APPLIED POSITION</MudText>
                            <MudText Typo="Typo.h5" Class="fw-bold">@overview.JobTitle</MudText>
                        </MudPaper>

                        <!-- Job Information Grid -->
                        <MudGrid Spacing="3" Class="mb-4">
                            <MudItem xs="12" sm="6" md="4">
                                <MudPaper Elevation="0" Class="pa-3" Style="background: var(--mud-palette-surface);">
                                    <div class="d-flex align-center mb-2">
                                        <MudIcon Icon="@Icons.Material.Filled.LocationOn" Size="Size.Small" Color="Color.Primary" Class="mr-2" />
                                        <MudText Typo="Typo.caption" Color="Color.Secondary" Class="text-uppercase">Location</MudText>
                                    </div>
                                    <MudText Typo="Typo.body1" Class="fw-medium">@overview.LocationOfjob</MudText>
                                </MudPaper>
                            </MudItem>
                            
                            <MudItem xs="12" sm="6" md="4">
                                <MudPaper Elevation="0" Class="pa-3" Style="background: var(--mud-palette-surface);">
                                    <div class="d-flex align-center mb-2">
                                        <MudIcon Icon="@Icons.Material.Filled.BusinessCenter" Size="Size.Small" Color="Color.Primary" Class="mr-2" />
                                        <MudText Typo="Typo.caption" Color="Color.Secondary" Class="text-uppercase">Employment Type</MudText>
                                    </div>
                                    <MudText Typo="Typo.body1" Class="fw-medium">@overview.EmployementType</MudText>
                                </MudPaper>
                            </MudItem>
                            
                            <MudItem xs="12" sm="6" md="4">
                                <MudPaper Elevation="0" Class="pa-3" Style="background: var(--mud-palette-surface);">
                                    <div class="d-flex align-center mb-2">
                                        <MudIcon Icon="@Icons.Material.Filled.AttachMoney" Size="Size.Small" Color="Color.Primary" Class="mr-2" />
                                        <MudText Typo="Typo.caption" Color="Color.Secondary" Class="text-uppercase">Salary Range</MudText>
                                    </div>
                                    <MudText Typo="Typo.body1" Class="fw-medium">@overview.SalaryFrom - @overview.SalaryTo</MudText>
                                </MudPaper>
                            </MudItem>
                        </MudGrid>

                        <MudDivider Class="my-4" />

                        <!-- Job Description -->
                        <div class="mb-4">
                            <div class="d-flex align-center mb-3">
                                <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Small" Color="Color.Primary" Class="mr-2" />
                                <MudText Typo="Typo.h6">Job Description</MudText>
                            </div>
                            <MudPaper Elevation="0" Class="pa-4" Style="background: var(--mud-palette-surface);">
                                <MudText Typo="Typo.body1" Style="line-height: 1.6;">@overview.JobDescription</MudText>
                            </MudPaper>
                        </div>

                        <MudDivider Class="my-4" />
                        <div class="mb-4">
                            <div class="d-flex align-center mb-3">
                                <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Small" Color="Color.Primary" Class="mr-2" />
                                <MudText Typo="Typo.h6">Job Requirement</MudText>
                            </div>
                            <MudPaper Elevation="0" Class="pa-4" Style="background: var(--mud-palette-surface);">
                                <MudText Typo="Typo.body1" Style="line-height: 1.6;">@overview.JobRequirement</MudText>
                            </MudPaper>
                        </div>
             
                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudGrid>
    }
</MudContainer>

@code {
    [Parameter]
    public int id { get; set; }

    private OverviewDtos? overview;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            overview = await _service.OverviewApplication(id);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching data: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }
}