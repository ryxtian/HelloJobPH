@page "/login"
@layout LandingLayout

@using HelloJobPH.Employer.Services.Authentication
@using HelloJobPH.Shared.DTOs
@inject IClientIAuthService AuthService
@inject ISnackbar Snackbar
@inject NavigationManager Nav

<MudContainer MaxWidth="MaxWidth.ExtraSmall" Class="mt-12">
    <MudPaper Elevation="4" Class="pa-6">
        <MudText Typo="Typo.h5" Align="Align.Center" GutterBottom="true" Class="mb-4">
            Welcome Admin
        </MudText>

        <EditForm Model="@model" OnValidSubmit="HandleLogin">
            <DataAnnotationsValidator />
            <MudTextField Label="Email" @bind-Value="model.Email" Required="true" />
            <MudTextField Label="Password" @bind-Value="model.Password" InputType="InputType.Password" Required="true" />
            <MudButton ButtonType="ButtonType.Submit" FullWidth="true" Color="Color.Primary">Login</MudButton>
        </EditForm>
    </MudPaper>
</MudContainer>

@code {
    private LoginDtos model = new();

    private async Task HandleLogin()
    {
        var success = await AuthService.LoginAsync(model);

        if (success)
        {
            Snackbar.Add("Login successful!", Severity.Success);
            Nav.NavigateTo("/dashboard");
        }
        else
        {
            Snackbar.Add("Invalid email or password.", Severity.Error);
        }
    }
}
